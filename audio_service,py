import pygst
pygst.require("0.10")
import gst
from threading import Thread, Lock

class AudioService(Thread):
        PLAYING = 0
        STOPPED = 1
        RANDOM = 2
        NOT_RANDOM = 3
        REPEAT_ALL = 4
        REPEAT_ONE = 5
        
        def __init__(self, playlist_provider):
                self.playlist = playlist_provider
                
                self.executive = gst.element_factory_make("playbin", "player")
                self.status = AudioService.STOPPED
                
                self.lock = Lock()
                
                self.active = True
                
        def play(self):
                if self.status == AudioService.STOPPED:
                        self.next()
    
        def next(self):
                self.lock.acquire()
                
                nn = self.playlist.next()
                self.executive.set_state(gst.STATE_NULL)
                self.executive.set_property("uri", nn) #NOTE: las uris locales requieren "file://"
                self.executive.set_state(gst.STATE_PLAYING)
                self.status = AudioService.PLAYING
                
                self.lock.release()

        def prev(self):
                self.lock.acquire()
                
                pv = self.playlist.prev()
                self.executive.set_state(gst.STATE_NULL)
                self.executive.set_property("uri", pv) #NOTE: las uris locales requieren "file://"
                self.executive.set_state(gst.STATE_PLAYING)
                self.status = AudioService.PLAYING
                
                self.lock.release()
